<!DOCTYPE html>
<html lang="mk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>–ë–µ—Å–∏–ª–∫–∞</title>
  <style>
    :root{ --bg:#0b1020; --panel:#121a33; --ink:#e6ecff; --muted:#9aa3c7; --accent:#6aa6ff; --good:#18c29c; --bad:#ff6b6b; --pill:#1a244a }
    *{box-sizing:border-box}
    button{-webkit-tap-highlight-color:transparent;-webkit-user-select:none}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:radial-gradient(1200px 600px at 70% -10%,#1a254d 0%,var(--bg) 60%);color:var(--ink);min-height:100vh;display:grid;place-items:center;padding-top:calc(20px + env(safe-area-inset-top));padding-bottom:calc(20px + env(safe-area-inset-bottom));padding-left:calc(20px + env(safe-area-inset-left));padding-right:calc(20px + env(safe-area-inset-right))}
    .wrap{width:min(1000px,100%)}
    header{text-align:center;margin-bottom:14px}
    header h1{margin:0;font-size:clamp(22px,4vw,36px)}
    header p{margin:6px 0 0;color:var(--muted)}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,0));border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,255,255,.05)}
    .grid{display:grid;gap:16px;grid-template-columns:1fr 1.1fr}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
    .canvasPane{background:var(--panel);border-radius:12px;padding:12px}
    canvas{width:100%;height:auto;display:block;border-radius:8px;background:#0d142b}
    .uiPane{display:grid;grid-template-rows:auto auto auto 1fr auto;gap:12px}
    .word{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center;background:var(--panel);padding:14px;border-radius:12px;min-height:64px;font-weight:700;letter-spacing:2px;font-size:clamp(20px,4.5vw,34px)}
    .word span{border-bottom:3px solid rgba(230,236,255,.15);min-width:24px;text-align:center;padding:2px 2px 4px}
    .word .space{border-bottom:none;width:16px}
    .status{text-align:center;color:var(--muted);min-height:24px}
    .status .win{color:var(--good);font-weight:700}
    .status .lose{color:var(--bad);font-weight:700}
    .pills{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
    .pill{background:var(--pill);border:1px solid rgba(255,255,255,.08);border-radius:999px;padding:6px 10px;font-size:13px;color:#cfd7ff;display:inline-flex;align-items:center;gap:6px}
    .pill .dot{width:8px;height:8px;border-radius:50%;display:inline-block}
    .pill.fast .dot{background:#18c29c}
    .pill.quick .dot{background:#59d0ff}
    .pill.med .dot{background:#ffcc66}
    .pill.slow .dot{background:#ff6b6b}
    .keyboard{display:grid;grid-template-columns:repeat(9,1fr);gap:8px}
    @media(max-width:900px){.keyboard{grid-template-columns:repeat(8,1fr)}}
    @media(max-width:520px){.keyboard{grid-template-columns:repeat(6,1fr)}}
    .keyboard button{background:#1a244a;border:1px solid rgba(255,255,255,.08);color:var(--ink);border-radius:10px;padding:10px 0;font-weight:700;cursor:pointer;font-size:clamp(16px,4vw,28px);transition:transform .05s ease,background .2s ease,opacity .2s ease}
    .keyboard button:active{transform:translateY(1px)}
    .keyboard button[disabled]{opacity:.45;cursor:not-allowed}
    .keyboard .good{background:#123a34}
    .keyboard .bad{background:#3a1a1a}
    .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:center}
    .controls button,.controls select{background:var(--accent);color:#081021;border:none;border-radius:10px;padding:10px 14px;font-weight:800;cursor:pointer;box-shadow:0 6px 16px rgba(106,166,255,.35)}
    .controls label{color:var(--muted);display:inline-flex;align-items:center;gap:8px;font-size:14px}
    .controls input[type="checkbox"]{width:18px;height:18px;accent-color:var(--accent)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    input[type="text"],input[type="password"],textarea{background:#101735;color:var(--ink);border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:10px 12px;font-size:16px;flex:1;min-width:180px}
    table{width:100%;border-collapse:separate;border-spacing:0 6px}
    th,td{text-align:left;padding:8px 10px}
    tbody tr{background:#0f1734}
    tbody tr td:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px}
    tbody tr td:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px}
    .hint{color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>–ë–µ—Å–∏–ª–∫–∞</h1>
      <p>–ò–≥—Ä–∞—á–∏—Ç–µ –Ω–∞–∏–∑–º–µ–Ω–∏—á–Ω–æ –∑–∞–¥–∞–≤–∞–∞—Ç —Ç–∞–µ–Ω –∑–±–æ—Ä. –û—Å—Ç–∞–Ω–∞—Ç–∏—Ç–µ —Ç—Ä–µ–±–∞ –¥–∞ –≥–æ –ø–æ–≥–æ–¥–∞—Ç –ø—Ä–µ–¥ –¥–∞ –∏—Å—Ç–µ—á–∞—Ç –∂–∏–≤–æ—Ç–∏—Ç–µ.</p>
    </header>

    <!-- –ï–ö–†–ê–ù 1: –õ–û–ë–ò -->
    <section id="screen-lobby" class="panel" aria-label="–õ–æ–±–∏">
      <h2 style="margin-top:0">1) –î–æ–¥–∞–¥–∏ –∏–≥—Ä–∞—á–∏</h2>
      <div class="row" style="margin-bottom:8px">
        <input id="playerName" type="text" placeholder="–ò–º–µ –Ω–∞ –∏–≥—Ä–∞—á" autocorrect="off" autocapitalize="none" spellcheck="false" />
        <button id="addPlayer">–î–æ–¥–∞—ò</button>
        <button id="startGame" title="–ó–∞–ø–æ—á–Ω–∏ –Ω–æ–≤–∞ –ø–∞—Ä—Ç–∏—ò–∞" disabled>–ó–∞–ø–æ—á–Ω–∏</button>
      </div>
      <div class="hint">–î–æ–¥–∞—ò –Ω–∞—ò–º–∞–ª–∫—É 2 –∏–≥—Ä–∞—á–∏. –ò–º–∏—ö–∞—Ç–∞ –º–æ–∂–∞—Ç –¥–∞ –±–∏–¥–∞—Ç –Ω–∞ –∫–∏—Ä–∏–ª–∏—Ü–∞ –∏–ª–∏ –ª–∞—Ç–∏–Ω–∏—Ü–∞.</div>
      <h3>–ò–≥—Ä–∞—á(–∏):</h3>
      <ul id="playerList" style="list-style:none; padding-left:0; display:flex; flex-wrap:wrap; gap:8px"></ul>
      <details style="margin-top:10px">
        <summary>–ü–æ—Å—Ç–∞–≤–∫–∏</summary>
        <label class="row"><input type="checkbox" id="hardMode"> –¢–µ–∂–æ–∫ —Ä–µ–∂–∏–º (6 –∂–∏–≤–æ—Ç–∏ –Ω–∞–º–µ—Å—Ç–æ 10)</label>
      </details>
    </section>

    <!-- –ï–ö–†–ê–ù 2: –í–ù–ï–° –ù–ê –ó–ë–û–† -->
    <section id="screen-set" class="panel" hidden>
      <h2 style="margin-top:0">2) –¢–∞–µ–Ω –∑–±–æ—Ä</h2>
      <p>–°–µ—Ç–∞—á: <b id="setterName">‚Äî</b></p>
      <div class="row" style="margin-bottom:8px">
        <input id="secretWord" type="text" placeholder="–í–Ω–µ—Å–∏ —Ç–∞–µ–Ω –∑–±–æ—Ä (–º–∞–∫–µ–¥–æ–Ω—Å–∫–∏)" autocorrect="off" autocapitalize="none" spellcheck="false" />
        <button id="toggleSecret">–°–æ–∫—Ä–∏—ò</button>
      </div>
      <div class="row" style="margin-bottom:8px">
        <input id="hintInput" type="text" placeholder="(–û–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ) –¢—Ä–∞–≥–∞/–∫–∞—Ç–µ–≥–æ—Ä–∏—ò–∞" autocorrect="off" autocapitalize="none" spellcheck="false" />
        <button id="beginRound">–ó–∞–ø–æ—á–Ω–∏ —Ä—É–Ω–¥–∞</button>
      </div>
      <div class="hint">–î–æ–∑–≤–æ–ª–µ–Ω–∏ —Å–µ –±—É–∫–≤–∏, –ø—Ä–∞–∑–Ω–∏–Ω–∏ –∏ —Ü—Ä—Ç–∏—á–∫–∏. –ó–±–æ—Ä–æ—Ç –∞–≤—Ç–æ–º–∞—Ç—Å–∫–∏ —Å–µ –ø—Ä–µ—Ç–≤–æ—Ä–∞ –≤–æ –ì–û–õ–ï–ú–ò –ë–£–ö–í–ò.</div>
    </section>

    <!-- –ï–ö–†–ê–ù 3: –ò–ì–†–ê -->
    <section id="screen-game" class="panel grid" hidden>
      <div class="canvasPane">
        <canvas id="board" width="640" height="480" aria-label="–¶—Ä—Ç–µ–∂ –Ω–∞ –±–µ—Å–∏–ª–∫–∞"></canvas>
      </div>
      <div class="uiPane">
        <div class="word" id="word" aria-live="polite"></div>
        <div class="status" id="status"></div>
        <div class="pills" id="speedPills"></div>
        <div class="status" id="timer">–í—Ä–µ–º–µ: 0s</div>
        <div class="keyboard" id="keyboard" aria-label="–ï–∫—Ä–∞–Ω—Å–∫–∞ —Ç–∞—Å—Ç–∞—Ç—É—Ä–∞"></div>
        <div class="controls">
          <button id="giveUp">–ü—Ä–µ–¥–∞—ò —Å–µ</button>
          <button id="nextRound" hidden>–°–ª–µ–¥–Ω–∞ —Ä—É–Ω–¥–∞</button>
        </div>
        <div class="hint" id="roundHint" style="text-align:center"></div>
      </div>
    </section>

    <!-- –ï–ö–†–ê–ù 4: –ù–ê–à–î–û–ë–†–ò -->
    <section id="screen-scores" class="panel" style="margin-top:14px">
      <div class="row" style="justify-content:space-between">
        <h2 style="margin:0">–¢–∞–±–µ–ª–∞</h2>
        <div class="row">
          <button id="resetScores" title="–†–µ—Å–µ—Ç–∏—Ä–∞—ò —Ç–∞–±–µ–ª–∞">–†–µ—Å–µ—Ç–∏—Ä–∞—ò</button>
          <button id="resetAll" title="–ò–∑–±—Ä–∏—à–∏ —Å√® –∏ –∑–∞–ø–æ—á–Ω–∏ –æ–¥–Ω–æ–≤–æ">–¶–µ–ª–æ—Å–µ–Ω —Ä–µ—Å–µ—Ç</button>
        </div>
      </div>
      <table>
        <thead><tr><th>#</th><th>–ò–≥—Ä–∞—á</th><th>–ü–æ–µ–Ω–∏</th><th>–ü–æ–±–µ–¥–∏</th><th>–ó–∞–¥–∞–≤–∞—ö–∞</th></tr></thead>
        <tbody id="scoreBody"></tbody>
      </table>
    </section>
  </div>

  <script>
    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    const ABC_MK = [ '–ê','–ë','–í','–ì','–î','–É','–ï','–ñ','–ó','–Ö','–ò','–à','–ö','–õ','–â','–ú','–ù','–ä','–û','–ü','–†','–°','–¢','–å','–£','–§','–•','–¶','–ß','–è','–®' ];
    const ALLOWED = new Set([...ABC_MK, ' ', '-']);

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî –°–æ—Å—Ç–æ—ò–±–∞ ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    let players = []; // {name, points, wins, sets}
    let setterIdx = 0; // —á–∏–µ –µ –¥–∞ –∑–∞–¥–∞–≤–∞
    let secret = '';
    let revealed = new Set();
    let misses = new Set();
    let lives = 10;
    let frozen = false;
    let hint = '';

    // —Ç–∞—ò–º–µ—Ä –∏ —Ñ–∏–∫—Å –∑–∞ —Ç–µ–∂–∏–Ω–∞ –ø–æ —Ä—É–Ω–¥–∞
    let t0 = 0; let tInt = null; let roundHard = false;

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî –ï–ª–µ–º–µ–Ω—Ç–∏ ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    const el = (id) => document.getElementById(id);
    const lobby = el('screen-lobby');
    const setScr = el('screen-set');
    const gameScr = el('screen-game');
    const board = el('board');
    const ctx = board.getContext('2d');
    const wordEl = el('word');
    const kbEl = el('keyboard');
    const statusEl = el('status');
    const roundHint = el('roundHint');
    const timerEl = el('timer');
    const pillsEl = el('speedPills');

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî –ü–æ–º–æ—à–Ω–∏ ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    function show(id){ lobby.hidden = id!=='lobby'; setScr.hidden = id!=='set'; gameScr.hidden = id!=='game'; }
    function uppercaseMk(str){ return str.toUpperCase(); }
    function normSecret(raw){ const up = uppercaseMk(raw).trim(); return [...up].filter(ch => ALLOWED.has(ch)).join(''); }
    function escapeHtml(str){ const div = document.createElement('div'); div.textContent = str; return div.innerHTML; }

    function saveScores(){ localStorage.setItem('mk_hangman_scores', JSON.stringify(players)); }
    function loadScores(){ try{ const d = JSON.parse(localStorage.getItem('mk_hangman_scores')||'[]'); if(Array.isArray(d)) players = d; }catch(e){} }

    function renderPlayers(){
      const ul = el('playerList'); ul.textContent = '';
      players.forEach((p,i)=>{
        const li = document.createElement('li'); li.style.background='#0f1734'; li.style.padding='6px 10px'; li.style.borderRadius='10px';

        const nameB = document.createElement('b');
        nameB.textContent = p.name;
        li.appendChild(nameB);

        li.appendChild(document.createTextNode(' '));

        const info = document.createElement('span');
        info.style.opacity = '.7';
        info.textContent = `(${p.points} –ø–æ–µ–Ω–∏)`;
        li.appendChild(info);

        li.appendChild(document.createTextNode(' '));

        const btn = document.createElement('button');
        btn.dataset.i = i;
        btn.style.marginLeft = '6px';
        btn.style.background = '#2a355f';
        btn.style.border = 'none';
        btn.style.color = '#fff';
        btn.style.borderRadius = '8px';
        btn.style.padding = '4px 8px';
        btn.style.cursor = 'pointer';
        btn.textContent = '‚úï';
        li.appendChild(btn);

        ul.appendChild(li);
      });
      ul.querySelectorAll('button[data-i]').forEach(btn=>{
        btn.addEventListener('click', ()=>{ players.splice(+btn.dataset.i,1); renderPlayers(); refreshStartEnabled(); saveScores(); });
      });
    }

    function refreshStartEnabled(){ el('startGame').disabled = players.length < 2; }

    function renderScores(){
      const body = el('scoreBody');
      const rows = [...players].map((p)=>p).sort((a,b)=> b.points - a.points);
      body.textContent = '';
      rows.forEach((p,idx)=>{
        const tr = document.createElement('tr');

        const rankTd = document.createElement('td'); rankTd.textContent = idx+1; tr.appendChild(rankTd);
        const nameTd = document.createElement('td'); nameTd.textContent = p.name; tr.appendChild(nameTd);
        const ptsTd = document.createElement('td'); const b = document.createElement('b'); b.textContent = p.points; ptsTd.appendChild(b); tr.appendChild(ptsTd);
        const winsTd = document.createElement('td'); winsTd.textContent = p.wins||0; tr.appendChild(winsTd);
        const setsTd = document.createElement('td'); setsTd.textContent = p.sets||0; tr.appendChild(setsTd);

        body.appendChild(tr);
      });
    }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî –¢–∞—ò–º–µ—Ä ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    function startTimer(){
      t0 = performance.now();
      clearInterval(tInt);
      timerEl.textContent = '–í—Ä–µ–º–µ: 0s';
      tInt = setInterval(()=>{
        const s = Math.floor((performance.now()-t0)/1000);
        timerEl.textContent = `–í—Ä–µ–º–µ: ${s}s`;
      }, 200);
      pillsEl.textContent = '';
    }
    function stopTimer(){ clearInterval(tInt); tInt = null; }
    function elapsedSeconds(){ return Math.floor((performance.now()-t0)/1000); }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî –ò–≥—Ä–∞ ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    function startSetScreen(){
      show('set');
      const setter = players[setterIdx];
      setter.sets = (setter.sets||0)+1;
      el('setterName').textContent = setter.name;
      el('secretWord').value = '';
      el('hintInput').value = '';
      el('toggleSecret').textContent = '–°–æ–∫—Ä–∏—ò'; // —Å—Ç–∞—Ä—Ç: –≤–∏–¥–ª–∏–≤–æ
      saveScores(); renderScores();
    }

    function startRound(){
      secret = normSecret(el('secretWord').value);
      if(!secret || ![...secret].some(ch=> ABC_MK.includes(ch))) { alert('–í–Ω–µ—Å–∏ –≤–∞–ª–∏–¥–µ–Ω –º–∞–∫–µ–¥–æ–Ω—Å–∫–∏ –∑–±–æ—Ä.'); return; }
      hint = el('hintInput').value.trim();
      revealed = new Set();
      misses = new Set();
      lives = el('hardMode').checked ? 6 : 10;
      roundHard = el('hardMode').checked; // –∑–∞–∫–ª—É—á–∏ —Ç–µ–∂–∏–Ω–∞ –∑–∞ —Ä—É–Ω–¥–∞—Ç–∞
      frozen = false;
      el('giveUp').disabled = false;
      el('nextRound').hidden = true;
      buildKeyboard();
      draw(0,true);
      renderWord();
      statusEl.textContent = `–ñ–∏–≤–æ—Ç–∏: ${lives} ¬∑ –°–µ—Ç–∞—á: ${players[setterIdx].name}`;
      roundHint.textContent = hint ? `–¢—Ä–∞–≥–∞: ${hint}` : '';
      startTimer();
      show('game');
    }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî –¢–ò–ï–†–ò (60/90/120) ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    function speedTier(seconds){
      if(seconds < 60) return { cls:'fast', label:'–ú–æ–ª—ö–∞', emoji:'‚ö°', guesserBonus:4, setterOnGuess:0 };
      if(seconds < 90) return { cls:'quick', label:'–ë—Ä–∑–æ', emoji:'üèÉ', guesserBonus:3, setterOnGuess:1 };
      if(seconds < 120) return { cls:'med', label:'–°—Ä–µ–¥–Ω–æ', emoji:'‚è±Ô∏è', guesserBonus:2, setterOnGuess:2 };
      return { cls:'slow', label:'–î–æ–ª–≥–æ', emoji:'üê¢', guesserBonus:0, setterOnGuess:3 };
    }

    function setterPointsOnFail(seconds){
      // –∫–æ–≥–∞ –ù–ï –µ –ø–æ–≥–æ–¥–µ–Ω–æ/–ø—Ä–µ–¥–∞–¥–µ–Ω–æ: –±–∞–∑–∞ + –≤—Ä–µ–º–µ–Ω—Å–∫–∏ –±–æ–Ω—É—Å (–ø–æ—Å—Ç—Ä–æ–≥–æ –∑–∞ –ø–æ–¥–æ–ª–≥–∏ —Ä—É–Ω–¥–∏)
      const base = roundHard ? 5 : 4;
      const time = seconds < 60 ? 1 : seconds < 90 ? 2 : seconds < 120 ? 3 : 5;
      return base + time;
    }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî –ö–†–ê–à –ù–ê –†–£–ù–î–ê ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    function endRound(won){
      if (frozen) return; // —Å–ø—Ä–µ—á–∏ –¥–≤–æ—ò–Ω–æ –±–æ–¥—É–≤–∞—ö–µ
      frozen = true;
      stopTimer();
      el('nextRound').hidden = false;
      el('giveUp').disabled = true;

      const secs = elapsedSeconds();
      const tier = speedTier(secs);

      // –≤–∏–∑—É–µ–ª–µ–Ω –±–µ—ü
      pillsEl.textContent = '';
      const pill = document.createElement('span');
      pill.className = `pill ${tier.cls}`;
      const dot = document.createElement('span'); dot.className = 'dot'; pill.appendChild(dot);
      pill.appendChild(document.createTextNode(` ${tier.emoji} ${tier.label} ¬∑ ${secs}s`));
      pillsEl.appendChild(pill);

      if (won) {
        // –†–∞—Ç–µ—Ä–∏: 1 (–±–∞–∑–∞) + –±—Ä–∑–∏–Ω—Å–∫–∏ –±–æ–Ω—É—Å —Å–ø–æ—Ä–µ–¥ —Ç–∏–µ—Ä + (—Ç–µ–∂–æ–∫ —Ä–µ–∂–∏–º +1)
        const base = 1;
        const hardWinBonus = roundHard ? 1 : 0;
        players.forEach((p,i)=>{
          if(i!==setterIdx){
            p.points = (p.points||0) + base + tier.guesserBonus + hardWinBonus;
            p.wins = (p.wins||0) + 1;
          }
        });
        // –°–µ—Ç–∞—á: —É—Ç–µ—Ö–∞ —Å–ø–æ—Ä–µ–¥ —Ç–∏–µ—Ä +1 –∞–∫–æ –µ —Ç–µ—à–∫–æ
        let setterPts = tier.setterOnGuess + (roundHard ? 1 : 0);
        players[setterIdx].points = (players[setterIdx].points||0) + setterPts;
        statusEl.textContent += ` ¬∑ –ü–æ–µ–Ω–∏: –†–∞—Ç–µ—Ä–∏ +${base}+${tier.guesserBonus}${hardWinBonus?`+${hardWinBonus}`:''} —Å–µ–∫–æ—ò ¬∑ –°–µ—Ç–∞—á +${setterPts}`;
      } else {
        // –†–∞—Ç–µ—Ä–∏: 0; –°–µ—Ç–∞—á: –±–∞–∑–∞ + –≤—Ä–µ–º–µ
        const setterPts = setterPointsOnFail(secs);
        players[setterIdx].points = (players[setterIdx].points||0) + setterPts;
        statusEl.textContent += ` ¬∑ –°–µ—Ç–∞—á +${setterPts} (–Ω–µ –µ –ø–æ–≥–æ–¥–µ–Ω–æ)`;
      }
      saveScores(); renderScores();
    }

    function nextRound(){ el('nextRound').hidden = true; setterIdx = (setterIdx + 1) % players.length; startSetScreen(); }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî –†–µ–Ω–¥–µ—Ä ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    function buildKeyboard(){
      kbEl.textContent = '';
      ABC_MK.concat(['-',' ']).forEach(l=>{
        const b = document.createElement('button'); b.textContent = l===' ' ? '‚ê£' : l; b.dataset.key = l;
        b.addEventListener('pointerdown', ()=> guess(l)); kbEl.appendChild(b);
      });
    }
    function renderWord(){
      wordEl.textContent='';
      for(const ch of secret){
        if(ch===' '){ const sp=document.createElement('span'); sp.className='space'; sp.textContent=' '; wordEl.appendChild(sp); }
        else if(ch==='-'){ const s=document.createElement('span'); s.textContent='-'; wordEl.appendChild(s); }
        else { const s=document.createElement('span'); s.textContent = revealed.has(ch) ? ch : '\u00A0'; wordEl.appendChild(s); }
      }
    }

    function guess(letter){
      if(frozen) return;
      if(!ALLOWED.has(letter)) return;
      if(revealed.has(letter) || misses.has(letter)) return;
      const btn = [...kbEl.children].find(b=>b.dataset.key===letter);
      if(secret.includes(letter)){
        revealed.add(letter); if(btn) btn.classList.add('good');
      }else{
        misses.add(letter); lives=Math.max(0,lives-1); if(btn) btn.classList.add('bad'); draw(misses.size);
      }
      if(btn) btn.disabled = true;
      renderWord();
      checkEnd();
    }

    document.addEventListener('keydown',(e)=>{
      if(gameScr.hidden) return; // —Å–∞–º–æ –≤–æ –∏–≥—Ä–∞
      const tag = e.target.tagName;
      if(['INPUT','TEXTAREA','SELECT','BUTTON'].includes(tag) || e.target.isContentEditable) return;
      const key = e.key.toUpperCase();
      const ch = key.length===1 ? key : (e.key===' ' ? ' ' : (e.key==='-'?'-':''));
      if(ALLOWED.has(ch)) { e.preventDefault(); guess(ch); }
    });

    function checkEnd(){
      if (frozen) return; // —Å–ø—Ä–µ—á–∏ –ø–æ–≤—Ç–æ—Ä–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞
      const uniq = new Set([...secret].filter(c=>c!==' ' && c!=='-'));
      const won = [...uniq].every(c=> revealed.has(c));
      if(won){
        statusEl.textContent = '';
        const winSpan = document.createElement('span'); winSpan.className = 'win'; winSpan.textContent = '–ü–æ–≥–æ–¥–æ–∫!';
        statusEl.appendChild(winSpan);
        statusEl.appendChild(document.createTextNode(' –ó–±–æ—Ä–æ—Ç –±–µ—à–µ '));
        const wordB = document.createElement('b'); wordB.textContent = secret; statusEl.appendChild(wordB);
        statusEl.appendChild(document.createTextNode('. –ö–ª–∏–∫–Ω–∏ ‚Äû–°–ª–µ–¥–Ω–∞ —Ä—É–Ω–¥–∞‚Äú.'));
        endRound(true); return;
      }
      if(lives<=0){
        statusEl.textContent = '';
        const loseSpan = document.createElement('span'); loseSpan.className = 'lose'; loseSpan.textContent = '–ù–µ–º–∞ –ø–æ–≤–µ—ú–µ –∂–∏–≤–æ—Ç–∏.';
        statusEl.appendChild(loseSpan);
        statusEl.appendChild(document.createTextNode(' –ó–±–æ—Ä–æ—Ç –±–µ—à–µ '));
        const wordB = document.createElement('b'); wordB.textContent = secret; statusEl.appendChild(wordB);
        statusEl.appendChild(document.createTextNode('. –ö–ª–∏–∫–Ω–∏ ‚Äû–°–ª–µ–¥–Ω–∞ —Ä—É–Ω–¥–∞‚Äú.'));
        revealed = uniq; renderWord(); endRound(false); return;
      }
      statusEl.textContent = `–ñ–∏–≤–æ—Ç–∏: ${lives} ¬∑ –°–µ—Ç–∞—á: ${players[setterIdx].name}`;
    }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî Canvas ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    function draw(mistakes, wipe=false){
      const dpr = window.devicePixelRatio || 1;
      const rect = board.getBoundingClientRect();
      const W = Math.max(480, Math.floor(rect.width));
      const H = Math.floor(W*0.75);
      board.width = Math.floor(W*dpr); board.height = Math.floor(H*dpr);
      board.style.height = H+'px'; board.style.width = W+'px';
      ctx.setTransform(dpr,0,0,dpr,0,0);
      ctx.clearRect(0,0,W,H);
      ctx.lineWidth=6; ctx.strokeStyle='#89a1ff'; ctx.lineCap='round';
      line(40,H-30,W-40,H-30); // –∑–µ–º—ò–∞
      line(100,H-30,100,60);   // —Å—Ç–æ–ª–±
      line(100,60,W*0.55,60);  // –≥—Ä–µ–¥–∞
      line(W*0.55,60,W*0.55,110); // —ò–∞–∂e
      const s = Math.min(10, mistakes);
      if(s>=1) circle(W*0.55,140,30);
      if(s>=2) line(W*0.55,170,W*0.55,260);
      if(s>=3) line(W*0.55,190,W*0.55-45,225);
      if(s>=4) line(W*0.55,190,W*0.55+45,225);
      if(s>=5) line(W*0.55,260,W*0.55-40,310);
      if(s>=6) line(W*0.55,260,W*0.55+40,310);
      if(s>=7) xEye(W*0.55-10,135);
      if(s>=8) xEye(W*0.55+10,135);
      if(s>=9) arc(W*0.55,150,10,Math.PI*0.1,Math.PI-Math.PI*0.1);
      if(s>=10) bird(W*0.55+70,95);
    }
    function line(x1,y1,x2,y2){ ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke(); }
    function circle(x,y,r){ ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.stroke(); }
    function arc(x,y,r,a1,a2){ ctx.beginPath(); ctx.arc(x,y,r,a1,a2); ctx.stroke(); }
    function xEye(x,y){ ctx.beginPath(); ctx.moveTo(x-4,y-4); ctx.lineTo(x+4,y+4); ctx.moveTo(x+4,y-4); ctx.lineTo(x-4,y+4); ctx.stroke(); }
    function bird(x,y){ ctx.beginPath(); ctx.moveTo(x-10,y); ctx.quadraticCurveTo(x,y-10,x+10,y); ctx.quadraticCurveTo(x,y-10,x-10,y); ctx.stroke(); }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî –ñ–∏—Ü–∏ ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    el('addPlayer').addEventListener('click',()=>{
      const name = el('playerName').value.trim();
      if(!name) return;
      players.push({name, points:0, wins:0, sets:0});
      el('playerName').value='';
      renderPlayers(); refreshStartEnabled(); saveScores(); renderScores();
    });
    el('playerName').addEventListener('keydown',(e)=>{ if(e.key==='Enter') el('addPlayer').click(); });

    el('startGame').addEventListener('click',()=>{ setterIdx = 0; startSetScreen(); });

    el('toggleSecret').addEventListener('click',()=>{
      const inp = el('secretWord');
      if (inp.type === 'text') { inp.type = 'password'; el('toggleSecret').textContent = '–ü—Ä–∏–∫–∞–∂–∏'; }
      else { inp.type = 'text'; el('toggleSecret').textContent = '–°–æ–∫—Ä–∏—ò'; }
    });

    el('beginRound').addEventListener('click', startRound);
    el('giveUp').addEventListener('click', () => {
      if (frozen) return;
      const ok = confirm('–°–∏–≥—É—Ä–Ω–æ –ª–∏ —Å–µ –ø—Ä–µ–¥–∞–≤–∞—à? –û–≤–∞ —ú–µ —ò–∞ –∑–∞–≤—Ä—à–∏ —Ä—É–Ω–¥–∞—Ç–∞ –∏ –º–æ–∂–µ –¥–∞ –¥–æ–¥–µ–ª–∏ –ø–æ–µ–Ω –Ω–∞ —Å–µ—Ç–∞—á–æ—Ç.');
      if (!ok) return;
      lives = 0;
      checkEnd();
    });
    el('nextRound').addEventListener('click', nextRound);

    window.addEventListener('resize', ()=> draw(misses.size));

    el('resetScores').addEventListener('click',()=>{
      if(confirm('–î–∞–ª–∏ –¥–∞ —ò–∞ –∏—Å—á–∏—Å—Ç–∞–º —Ç–∞–±–µ–ª–∞—Ç–∞?')){ players.forEach(p=>{p.points=0;p.wins=0;p.sets=0}); saveScores(); renderScores(); renderPlayers(); }
    });

    el('resetAll').addEventListener('click',()=>{
      if(!confirm('–¶–µ–ª–æ—Å–µ–Ω —Ä–µ—Å–µ—Ç? –û–≤–∞ —ú–µ –≥–∏ –∏–∑–±—Ä–∏—à–µ –∏–≥—Ä–∞—á–∏—Ç–µ, –ø–æ–µ–Ω–∏—Ç–µ –∏ –ø–æ—Å—Ç–∞–≤–∫–∏—Ç–µ.')) return;
      try { localStorage.removeItem('mk_hangman_scores'); } catch(e){}
      players = [];
      setterIdx = 0; secret = ''; revealed = new Set(); misses = new Set(); lives = 10; frozen = false; hint = '';
      const hard = el('hardMode'); if (hard) hard.checked = false;
      el('playerName').value='';
      // Clear UI
      el('word').textContent='';
      el('keyboard').textContent='';
      el('status').textContent='';
      el('roundHint').textContent='';
      pillsEl.textContent='';
      stopTimer();
      el('timer').textContent='–í—Ä–µ–º–µ: 0s';
      renderPlayers(); renderScores(); refreshStartEnabled(); show('lobby');
    });

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî –ò–Ω–∏—Ü–∏—ò–∞–ª–∏–∑–∞—Ü–∏—ò–∞ ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
    loadScores();
    renderPlayers();
    renderScores();
    refreshStartEnabled();
    show('lobby');
  </script>
</body>
</html>
